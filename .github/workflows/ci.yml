# This workflow will do a clean install of node dependencies, cache/restore them, build the source code and run tests across different versions of node
# For more information see: https://help.github.com/actions/language-and-framework-guides/using-nodejs-with-github-actions
name: Build and deploy
on:
  push:
    branches: [dev, main]
jobs:
  build-prod:
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    strategy:
      matrix:
        node-version: [14.x]
        # See supported Node.js release schedule at https://nodejs.org/en/about/releases/
    steps:
      - name: Git checkout
        uses: actions/checkout@v2

      - name: Configure AWS credentials
        uses: aws-actions/configure-aws-credentials@v1
        with:
          aws-access-key-id: '${{ secrets.AWS_ACCESS_KEY_ID }}'
          aws-secret-access-key: '${{ secrets.AWS_SECRET_ACCESS_KEY }}'
          aws-region: us-east-1

      - name: Login to Amazon ECR
        id: login-ecr
        uses: aws-actions/amazon-ecr-login@v1

      - name: Restore cache
        uses: actions/cache@v2
        with:
          path: |
            ${{ github.workspace }}/node_modules
            ${{ github.workspace }}/.next/cache
          key: ${{ runner.os }}-nextjs-${{ hashFiles('**/yarn-lock.json') }}-${{ hashFiles('**/*.js') }}
          restore-keys: |
            ${{ runner.os }}-nextjs-${{ hashFiles('**/yarn-lock.json') }}-
      - name: Build, tag, and push the image to Amazon ECR
        id: build-image
        env:
          ECR_REGISTRY: ${{ steps.login-ecr.outputs.registry }}
          ECR_REPOSITORY: sparkpay-fe
          IMAGE_TAG: ${{ github.run_number }}
          NEXT_PUBLIC_API_URL: https://api.sparkpayhq.com
          NEXT_PUBLIC_PAYSTACK_KEY: pk_live_c084fb719880036900c1f93f16018447e6760ecd
          NEXT_PUBLIC_JWT_KEY: cGtfdGVzdF8zMmRhNWY5N2Q0ZDIyYjE3ZDYzYjdlYTRkMmQ1MTAzNmY3YWZmOTE0
          NEXT_PUBLIC_EMPLOYEE_UPLOAD_SAMPLE: data:@file/vnd.openxmlformats-officedocument.spreadsheetml.sheet;base64,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
        run: |
          # Build a docker container and push it to ECR
          yarn install
          yarn build
          docker build -t $ECR_REGISTRY/$ECR_REPOSITORY:latest-prod .
          echo "Pushing image to ECR..."
          docker push $ECR_REGISTRY/$ECR_REPOSITORY:latest-prod
          echo "::set-output name=image::$ECR_REGISTRY/$ECR_REPOSITORY:latest-prod"

      - name: Render Amazon ECS task definition
        id: task-def
        uses: aws-actions/amazon-ecs-render-task-definition@v1
        with:
          task-definition: task-definitions/production.json
          container-name: sparkpay-fe
          image: '${{ steps.build-image.outputs.image }}'

      - name: Deploy Amazon ECS task definition
        uses: aws-actions/amazon-ecs-deploy-task-definition@v1
        with:
          task-definition: ${{ steps.task-def.outputs.task-definition }}
          service: sparkpay-fe
          cluster: sparkpay-fe
          wait-for-service-stability: true
  build-dev:
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/dev'
    strategy:
      matrix:
        node-version: [14.x]
        # See supported Node.js release schedule at https://nodejs.org/en/about/releases/
    steps:
      - name: Git checkout
        uses: actions/checkout@v2

      - name: Configure AWS credentials
        uses: aws-actions/configure-aws-credentials@v1
        with:
          aws-access-key-id: '${{ secrets.AWS_ACCESS_KEY_ID }}'
          aws-secret-access-key: '${{ secrets.AWS_SECRET_ACCESS_KEY }}'
          aws-region: us-east-1

      - name: Login to Amazon ECR
        id: login-ecr
        uses: aws-actions/amazon-ecr-login@v1

      - name: Restore cache
        uses: actions/cache@v2
        with:
          path: |
            ${{ github.workspace }}/node_modules
            ${{ github.workspace }}/.next/cache
          key: ${{ runner.os }}-nextjs-${{ hashFiles('**/yarn-lock.json') }}-${{ hashFiles('**/*.js') }}
          restore-keys: |
            ${{ runner.os }}-nextjs-${{ hashFiles('**/yarn-lock.json') }}-
      - name: Build, tag, and push the image to Amazon ECR
        id: build-image
        env:
          ECR_REGISTRY: ${{ steps.login-ecr.outputs.registry }}
          ECR_REPOSITORY: sparkpay-fe
          IMAGE_TAG: ${{ github.run_number }}
          NEXT_PUBLIC_API_URL: https://devapi.sparkpayhq.com
          NEXT_PUBLIC_PAYSTACK_KEY: pk_test_0c5091a3d62e119d13cfb685d63598966385fddc
          NEXT_PUBLIC_JWT_KEY: cGtfdGVzdF8zMmRhNWY5N2Q0ZDIyYjE3ZDYzYjdlYTRkMmQ1MTAzNmY3YWZmOTE0
          NEXT_PUBLIC_EMPLOYEE_UPLOAD_SAMPLE: data:@file/vnd.openxmlformats-officedocument.spreadsheetml.sheet;base64,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
        run: |
          # Build a docker container and push it to ECR
          yarn install
          yarn build
          docker build -t $ECR_REGISTRY/$ECR_REPOSITORY:latest-dev .
          echo "Pushing image to ECR..."
          docker push $ECR_REGISTRY/$ECR_REPOSITORY:latest-dev
          echo "::set-output name=image::$ECR_REGISTRY/$ECR_REPOSITORY:latest-dev"

      - name: Render Amazon ECS task definition
        id: task-def
        uses: aws-actions/amazon-ecs-render-task-definition@v1
        with:
          task-definition: task-definitions/staging.json
          container-name: sparkpay-staging-fe
          image: '${{ steps.build-image.outputs.image }}'

      - name: Deploy Amazon ECS task definition
        uses: aws-actions/amazon-ecs-deploy-task-definition@v1
        with:
          task-definition: ${{ steps.task-def.outputs.task-definition }}
          service: sparkpay-staging-fe-service
          cluster: sparkpay-staging-fe
          wait-for-service-stability: true
